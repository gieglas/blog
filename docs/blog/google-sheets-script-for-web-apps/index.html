<!doctype html>
<html lang="en">
    <head>
    <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Social -->
        <meta property="og:description" content="Another Google App Script to show HTML as a web app following the same rules as in my previous post.">
        <meta property="og:title" content="Google Sheets Script for Web Apps - Con&#39;s place">
        <meta property="og:url" content="https://consevangelou.com/">
        <meta property="og:type" content="website">
        <meta property="og:image" content="/img/Sheet-to-Web-App.png">
        <meta property="og:site_name" content="Con&#39;s place">
    
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://consevangelou.com/">
        <meta property="twitter:title" content="Google Sheets Script for Web Apps - Con&#39;s place">
        <meta property="twitter:description" content="Another Google App Script to show HTML as a web app following the same rules as in my previous post.">
        <meta property="twitter:image" content="/img/Sheet-to-Web-App.png">
        <!-- Theme --> 
        <link rel="manifest" href="/manifest.json">
        <meta name="theme-color" content="#0090d3">
        <link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144x144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/apple-touch-icon-120x120-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon-57x57-precomposed.png">
        <!-- Bootstrap CSS -->
        <link href="/css/main.css" rel="stylesheet" >
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic"/>
        <link href="/css/docs.css" rel="stylesheet" >
        <!-- Prism Highlighter CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-a11y-dark.min.css" rel="stylesheet">
        <title>Google Sheets Script for Web Apps - Con&#39;s place</title>
        <meta name="description" content="Another Google App Script to show HTML as a web app following the same rules as in my previous post.">
        <meta name="author" content="Constantinos Evangelou">
    </head>
    <body>
        <!-- Skip link -->
        <a href="#mainContainer" class="govcy-skip-link govcy-mb-0">Skip to main content</a> 
        <!--Header-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Shadows+Into+Light+Two&display=swap" rel="stylesheet">
    <div class="d-none govcy-p-0 govcy-m-0 d-print-block">
        <a href="/" class="desktop-header">
            <img src="/img/GieglasIconInverse.png" alt="Con's place logo" aria-hidden="true">
            Con's place
        </a>
    </div>
    <header class="govcy-container-fluid govcy-p-0 govcy-pt-2 govcy-m-0 govcy-position-relative govcy-d-print-none ce-header">
         <div class="govcy-container">
             <div class="row">
                <!--Displayed only on desktop-->
                <div class="d-none d-md-block govcy-p-0 govcy-m-0 ">
                    <a href="/" class="desktop-header personal-logo">
                        <img aria-hidden="true" alt="Con&#39;s place logo" src="/img/GieglasIconInverse.png">
                        Con&#39;s place
                    </a>
                </div>
                <!-- Diplay only on desktop end -->
                <span class="d-none d-md-block tagline govcy-mb-0 govcy-mt-1 govcy-ml-1">Be creative </span>
                <div class="govcy-header govcy-mb-0">
                    <nav class="navbar navbar-expand-md navbar-light">
                        <div class="govcy-container govcy-p-0 govcy-m-0 govcy-mr-2">
                            <!--Displayed only on mobile-->
                            <div class="d-md-none"><a href="/" class="mobile-header personal-logo"><img alt="Con&#39;s place" src="/img/GieglasIconInverse.png">Con&#39;s place</a></div>
                            <!-- Displayed only on mobile end -->
                            <!-- Displayed only on mobile button-->                            
                            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                <span>
                                    <span style="vertical-align: middle !important;" class="govcy-mr-1 material-icons">menu</span>Menu 
                                </span>
                            </button>
                            <!-- Displayed only on mobile end -->
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                <ul class="navbar-nav me-auto mb-2 mb-md-0 govcy-ml-3">
                                    <li class="nav-item">
                                    <a href="/"  class="nav-link" >
                                        Home
                                    </a>
                                    </li><li class="nav-item">
                                    <a href="/blog/"  class="nav-link active" aria-current="page" >
                                        Blog
                                    </a>
                                    </li><li class="nav-item">
                                    <a href="/about/"  class="nav-link" >
                                        About
                                    </a>
                                    </li><li class="nav-item">
                                    <a href="/search/"  class="nav-link" >
                                        Search
                                    </a>
                                    </li></ul>
                                
                                
                                
                                
                            </div>
                        </div>
                    </nav>
                    <!--Displayed only on mobile-->
                    <span class="d-md-none tagline govcy-mb-0 govcy-ml-3">Be creative </span>
                    <!-- Displayed only on mobile  end -->
                </div>
             </div>
         </div>
    </header>
    
        <!--Main-->
        <main class="govcy-container govcy-my-4" id="mainContainer">
            <div class="row">
                <div class="govcy-col-8 govcy-order-last">
                    <h1>Google Sheets Script for Web Apps</h1>
                    <p class="post-date">Posted on 
                                      <time datetime="2019-03-01T00:00:00.000Z">1 March 2019</time> 
                                      • Tagged with 
                                      
                                            <a class="post-tag" href="/tags/dev">dev</a>
                                        
                                            <a class="post-tag" href="/tags/google-sheets">google-sheets</a>
                                        
                                            <a class="post-tag" href="/tags/productivity">productivity</a>
                                        </p>
                    
                     
                    <img aria-hidden="true" src="/img/Sheet-to-Web-App.png" alt="Graphic for Google Sheets Script for Web Apps" class="img-fluid pop-small govcy-mb-4"></a>
                    
                    <div class="blog-page">
                    <p>Following on the post for <a href="../google-sheets-script-for-email-report/">Google Sheets Script for email Report</a>, I wrote another Google App Script to also show HTML as a web app following the same rules as in my previous post.</p>
<p>To publish the Google App Script I used the “<a href="https://developers.google.com/apps-script/guides/web">Publish as Web App</a>” functionality.</p>
<p><img src="../../img/Google-App-Script-Publish-Web-App.png" alt="Publish web app screenshot" class="img-fluid pop-small govcy-mb-3"></p>
<p>See below the actual script I used.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/**************************************************************************/</span><br><span class="token comment">/**<br> * Send email, displays HTML or send dynamic notifications of the sheet contents based on the options defined in the "Options" sheet.<br> *<br> * The "Options" sheet, must have the following values in row 6<br> * |name    | title | headersAtRow  | display   | columnsToSend | Email Addresses Column | Current Date | Emails addresses  | Message Prefix    | Message PostFix   | Subject<br> * <br> * The first 5 columns concern Information about which sheets to send the email and what content. Can have more that 1 row for each sheet to send. 1 row for each sheet. <br> * Email Addresses to send the notifications<br> * The next 5 columns concern Information about the notification email header. Only 1 row of options is valid<br> *<br> * More details about the columns of "Email Options" sheet:<br> * - name:               The name of the sheet (per sheet)<br> * - title:              The Title of the sheet to be displayed in the email (per sheet)<br> * - headersAtRow:       Where is the header row located in the sheet. The header will contain the titles of the columns and the next row will contain the data (Row 1 is 0) (per sheet)<br> * - display:            The display format of the content in the email. Can be 1 of the following formats: table, list, numbered, lines, boxes1, boxes2, boxes3, <br> *                           chart_bar, chart_column, chart_line, chart_scatter, chart_area, chart_pie, chart_table, title (Not linked to a sheet) ,paragraph (Not linked to a sheet) (per sheet)<br> * - columnsToSend:      Which columns to include in the contents of the email, separated by comma. (Column A is 0). Example 0,1,2 (per sheet)<br> * - Email Addresses Column: Column with Email Addresses to send the notifications. Separate emails with a comma on dynamic emails<br> * - Current Date:       The current date (No need to change this)<br> * - Emails addresses:   Email addresses to send the notifications. Separate emails with a comma<br> * - Message Prefix:     The notification message header (in HTML Format)<br> * - Message PostFix:    The notification email footer (in HTML Format)<br> * - Subject:            The subject of the enail<br> */</span><br> <br><span class="token keyword">function</span> <span class="token function">dynamicEmail</span><span class="token punctuation">(</span><span class="token parameter">emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span> replaceLinks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span>  <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - dynamicEmail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - dynamicEmail STARTED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>   <br>  <span class="token comment">//default values</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>emailOptionsSheet <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> emailOptionsSheet<span class="token operator">=</span><span class="token string">"Email Options"</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> enableStackdriverLogging<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>logingName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> logingName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>replaceLinks <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> replaceLinks <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br> <br>    <span class="token comment">// get active spreadsheet</span><br>    <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sheetUrl <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//get Options start---------------------------</span><br>    <span class="token keyword">var</span> sOptions2<span class="token operator">=</span>ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>emailOptionsSheet<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2range <span class="token operator">=</span> sOptions2<span class="token punctuation">.</span><span class="token function">getDataRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2values <span class="token operator">=</span> sOptions2range<span class="token punctuation">.</span><span class="token function">getDisplayValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>     <br>    <span class="token comment">//get header options    </span><br>    <span class="token keyword">var</span> email <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <br>    <span class="token keyword">var</span> messageSubject <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//get HTML message </span><br>    <span class="token keyword">var</span> templData <span class="token operator">=</span> <span class="token function">prepareTemplateData</span><span class="token punctuation">(</span>emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span>replaceLinks<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> countEmails <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> dynamicEmailObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token comment">//for each section evaluate the template</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> templData<span class="token punctuation">.</span>sections<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>      <br>      <span class="token comment">//for every email in dynamic emails</span><br>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>        <span class="token keyword">var</span> emailPattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span><br>        <span class="token comment">//check if is email</span><br>        <span class="token keyword">if</span><span class="token punctuation">(</span>emailPattern<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" dynamicEmail: Email NOT VALID -  "</span> <span class="token operator">+</span> templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>          <span class="token comment">//if new email initialize</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dynamicEmailObj<span class="token punctuation">[</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            dynamicEmailObj<span class="token punctuation">[</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>           <br>          <span class="token keyword">var</span> dynamicEmailObjData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">"data"</span><span class="token operator">:</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string-property property">"headers"</span><span class="token operator">:</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>headers<span class="token punctuation">,</span> <span class="token string-property property">"style"</span><span class="token operator">:</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>          dynamicEmailObj<span class="token punctuation">[</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dynamicEmailObjData<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">//get the object keys (basically emails) </span><br>    <span class="token keyword">var</span> objKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dynamicEmailObj<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>      <span class="token comment">//create template based on display</span><br>      <span class="token keyword">var</span> t <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">"templ_dynamicEmail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      t<span class="token punctuation">.</span>title <span class="token operator">=</span> templData<span class="token punctuation">.</span>title<span class="token punctuation">;</span><br>      t<span class="token punctuation">.</span>messagePreFix <span class="token operator">=</span> templData<span class="token punctuation">.</span>messagePreFix<span class="token punctuation">;</span><br>      t<span class="token punctuation">.</span>messagePostFix <span class="token operator">=</span> templData<span class="token punctuation">.</span>messagePostFix<span class="token punctuation">;</span><br>      t<span class="token punctuation">.</span>data <span class="token operator">=</span> dynamicEmailObj<span class="token punctuation">[</span>objKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>      <span class="token keyword">var</span> ht<span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addMetaTag</span><span class="token punctuation">(</span><span class="token string">'viewport'</span><span class="token punctuation">,</span> <span class="token string">'width=device-width, initial-scale=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//.getContent();</span><br>        <br>      <span class="token comment">//send email</span><br>      MailApp<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>          <span class="token literal-property property">to</span><span class="token operator">:</span> objKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">subject</span><span class="token operator">:</span> templData<span class="token punctuation">.</span>title <span class="token punctuation">,</span><br>          <span class="token literal-property property">htmlBody</span><span class="token operator">:</span> ht<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <br>    <span class="token punctuation">}</span><br>     <br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" dynamicEmail ERROR: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - dynamicEmail ENDED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - dynamicEmail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br> <br><span class="token punctuation">}</span><br> <br><span class="token comment">/** Send email of the sheet contents based on the options defined in the "Email Options" sheet.<br> *<br> * @param {string} emailOptionsSheet the sheet name for the Email Options. Default is "Email Options"<br> * @param {boolean} enableStackdriverLogging True to enable Stackdriver Logging. Default is false<br> * @param {string} logingName logging name to be appended in the message. Default is ""<br> * @param {boolean} replaceLinks True to replace links with &lt;a href...> tags. Default is false<br> * @return {void} Not applicable.<br> */</span><br><span class="token keyword">function</span> <span class="token function">emailSheetContent</span><span class="token punctuation">(</span><span class="token parameter">emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span> replaceLinks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token comment">//default values</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>emailOptionsSheet <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> emailOptionsSheet<span class="token operator">=</span><span class="token string">"Email Options"</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> enableStackdriverLogging<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>logingName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> logingName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>replaceLinks <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> replaceLinks <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>     <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - emailSheetContent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - emailSheetContent STARTED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">// get active spreadsheet</span><br>    <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sheetUrl <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//get Options start---------------------------</span><br>    <span class="token keyword">var</span> sOptions2<span class="token operator">=</span>ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>emailOptionsSheet<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2range <span class="token operator">=</span> sOptions2<span class="token punctuation">.</span><span class="token function">getDataRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2values <span class="token operator">=</span> sOptions2range<span class="token punctuation">.</span><span class="token function">getDisplayValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>     <br>    <span class="token comment">//get header options    </span><br>    <span class="token keyword">var</span> email <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <br>    <span class="token keyword">var</span> messageSubject <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token comment">//get Options end---------------------------</span><br>     <br>    <span class="token comment">//Sheet to HTML</span><br>    message <span class="token operator">=</span> <span class="token function">htmlSheetContent</span><span class="token punctuation">(</span>emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span> replaceLinks<span class="token punctuation">,</span> <span class="token string">"templ_email"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//if message is generated send email</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      MailApp<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>        <span class="token literal-property property">to</span><span class="token operator">:</span> email<span class="token punctuation">,</span><br>        <span class="token literal-property property">subject</span><span class="token operator">:</span> messageSubject<span class="token punctuation">,</span><br>        <span class="token literal-property property">htmlBody</span><span class="token operator">:</span> message<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" ERROR: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - emailSheetContent ENDED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - emailSheetContent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br> <br><span class="token punctuation">}</span><br> <br><span class="token comment">/**<br> * Include contents of an HTML file in another. Usefull when including stylesheets or JS<br> *<br> * @param {string} filename The filename of the file to be included in HTML<br> * @return {string} The HTML.<br> */</span><br><span class="token keyword">function</span> <span class="token function">include</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> HtmlService<span class="token punctuation">.</span><span class="token function">createHtmlOutputFromFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token comment">/***************************************************************************************************************************/</span><br><span class="token comment">/**<br> * Create the HtmlOutput based on a sheet contents defined in the "Email Options" sheet. Information about options in function "emailSheetContent"<br> *<br> * @param {string} emailOptionsSheet the sheet name for the Email Options. Default is "Email Options"<br> * @param {boolean} enableStackdriverLogging True to enable Stackdriver Logging. Default is false<br> * @param {string} logingName logging name to be appended in the message. Default is ""<br> * @param {boolean} replaceLinks True to replace links with &lt;a href...> tags. Default is false<br> * @param {string} masterTemplate master Template name <br> * @return {HtmlOutput} The HTML Output<br> */</span><br><span class="token keyword">function</span> <span class="token function">htmlSheetContent</span><span class="token punctuation">(</span><span class="token parameter">emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span> replaceLinks<span class="token punctuation">,</span> masterTemplate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <br>  <span class="token keyword">var</span> ht <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>     <br>    <span class="token comment">//default values</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>emailOptionsSheet <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> emailOptionsSheet<span class="token operator">=</span><span class="token string">"Email Options"</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> enableStackdriverLogging<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>logingName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> logingName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>replaceLinks <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> replaceLinks <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>masterTemplate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> masterTemplate <span class="token operator">=</span> <span class="token string">"templ_index"</span><span class="token punctuation">;</span><br>     <br>    <span class="token keyword">var</span> t <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span>masterTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span> <br>     <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - htmlSheetContent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - htmlSheetContent STARTED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">// get active spreadsheet</span><br>    <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sheetUrl <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>     <br>    <span class="token comment">//get HTML message </span><br>    <span class="token keyword">var</span> templData <span class="token operator">=</span> <span class="token function">prepareTemplateData</span><span class="token punctuation">(</span>emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span>replaceLinks<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <br>    <span class="token keyword">var</span> sectionsHTML <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token comment">//for each section evaluate the template</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> templData<span class="token punctuation">.</span>sections<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>      <span class="token keyword">var</span> templateName <span class="token operator">=</span> <span class="token string">'templ_'</span> <span class="token operator">+</span> templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>display<span class="token punctuation">;</span><br>      <span class="token keyword">var</span> chart <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>      <span class="token comment">//Charts      </span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>display<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"chart"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">//create chart object</span><br>        <span class="token keyword">switch</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>display<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_bar"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newBarChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_column"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newColumnChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_line"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newLineChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_scatter"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newScatterChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_area"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newAreaChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_pie"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newPieChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_table"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span> Charts<span class="token punctuation">.</span><span class="token function">newTableChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>          <span class="token keyword">case</span> <span class="token string">"chart_table"</span><span class="token operator">:</span><br>          chart <span class="token operator">=</span>  Charts<span class="token punctuation">.</span><span class="token function">newTableChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataTable</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDimensions</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">break</span><span class="token punctuation">;</span><br>             <br>        <span class="token punctuation">}</span><br>        <span class="token comment">//output html from chart object      </span><br>        <span class="token keyword">var</span> htmlOutput <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createHtmlOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> imageData <span class="token operator">=</span> Utilities<span class="token punctuation">.</span><span class="token function">base64Encode</span><span class="token punctuation">(</span>chart<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">"&lt;img class='img-responsive' alt='If you cannot see the image your applications does not suport it.' border=\"1\" src=\""</span> <span class="token operator">+</span> <span class="token string">"data:image/png;base64,"</span> <span class="token operator">+</span> <span class="token function">encodeURI</span><span class="token punctuation">(</span>imageData<span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">"\">"</span><span class="token punctuation">;</span><br>         <br>        templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data <span class="token operator">=</span> html<span class="token punctuation">;</span>        <br>        templateName <span class="token operator">=</span> <span class="token string">"templ_chart_bar"</span><span class="token punctuation">;</span>        <br>      <span class="token punctuation">}</span>       <br>      <span class="token comment">//create template based on display</span><br>      <span class="token keyword">var</span> templ_section <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span>templateName<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      templ_section<span class="token punctuation">.</span>templDataSection <span class="token operator">=</span> templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>      sectionsHTML <span class="token operator">=</span> sectionsHTML <span class="token operator">+</span> templ_section<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>       <br>    <span class="token punctuation">}</span><br>     <br>    <span class="token comment">//Create template</span><br>    <span class="token keyword">var</span> templ_index <span class="token operator">=</span> t<span class="token punctuation">;</span><br>    t<span class="token punctuation">.</span>messagePreFix <span class="token operator">=</span> templData<span class="token punctuation">.</span>messagePreFix<span class="token punctuation">;</span><br>    t<span class="token punctuation">.</span>messagePostFix <span class="token operator">=</span> templData<span class="token punctuation">.</span>messagePostFix<span class="token punctuation">;</span><br>    t<span class="token punctuation">.</span>data <span class="token operator">=</span>sectionsHTML<span class="token punctuation">;</span><br>    t<span class="token punctuation">.</span>title<span class="token operator">=</span>templData<span class="token punctuation">.</span>title<span class="token punctuation">;</span><br>    ht <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addMetaTag</span><span class="token punctuation">(</span><span class="token string">'viewport'</span><span class="token punctuation">,</span> <span class="token string">'width=device-width, initial-scale=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    ht<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>templData<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" ERROR: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>    ht <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - htmlOutput: "</span> <span class="token operator">+</span> ht<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - htmlSheetContent ENDED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - htmlSheetContent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> ht<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br> <br> <br><span class="token comment">/**<br> * Prepares the data for the templates based on a sheet contents defined in the "Email Options" sheet. Information about options in function "emailSheetContent"<br> *<br> * @param {string} emailOptionsSheet the sheet name for the Email Options. Default is "Email Options"<br> * @param {boolean} enableStackdriverLogging True to enable Stackdriver Logging. Default is false<br> * @param {string} logingName logging name to be appended in the message. Default is ""<br> * @param {boolean} replaceLinks True to replace links with &lt;a href...> tags. Default is false<br> * @return {json} The Template data.<br> */</span><br><span class="token keyword">function</span> <span class="token function">prepareTemplateData</span><span class="token punctuation">(</span><span class="token parameter">emailOptionsSheet<span class="token punctuation">,</span>enableStackdriverLogging<span class="token punctuation">,</span> logingName<span class="token punctuation">,</span>replaceLinks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">//template Data ********************************************* Init</span><br>  <span class="token keyword">var</span> templData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">"messagePreFix"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string-property property">"messagePostFix"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string-property property">"sections"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token comment">//default values</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>emailOptionsSheet <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> emailOptionsSheet<span class="token operator">=</span><span class="token string">"Email Options"</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> enableStackdriverLogging<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>logingName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> logingName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>     <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - prepareTemplateData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - prepareTemplateData STARTED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token keyword">var</span> sheetsToEmail <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">// get active spreadsheet</span><br>    <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sheetUrl <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//get Options start---------------------------</span><br>    <span class="token keyword">var</span> sOptions2<span class="token operator">=</span>ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>emailOptionsSheet<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2range <span class="token operator">=</span> sOptions2<span class="token punctuation">.</span><span class="token function">getDataRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2values <span class="token operator">=</span> sOptions2range<span class="token punctuation">.</span><span class="token function">getDisplayValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> sOptions2lastRow <span class="token operator">=</span> sOptions2range<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//for each row in body options sheet</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> f <span class="token operator">&lt;</span> sOptions2lastRow<span class="token punctuation">;</span> f<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>      sheetsToEmail<span class="token punctuation">[</span>f<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">""</span> <span class="token operator">+</span> sOptions2values<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> sOptions2values<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">headersAtRow</span> <span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sOptions2values<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><br>                            <span class="token punctuation">,</span> <span class="token literal-property property">display</span><span class="token operator">:</span> sOptions2values<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">columnsToSend</span><span class="token operator">:</span> sOptions2values<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><br>                            <span class="token punctuation">,</span> <span class="token literal-property property">emailColumn</span><span class="token operator">:</span> sOptions2values<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>      <br>    <span class="token punctuation">}</span>    <br>     <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - prepareTemplateData Options set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>     <br>    <span class="token comment">//get header options    </span><br>    <span class="token comment">//var email = sOptions2values[5][7];  </span><br>    <span class="token keyword">var</span> messagePreFix <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> messagePostFix <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> messageSubject <span class="token operator">=</span> sOptions2values<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>     <br>    templData<span class="token punctuation">.</span>messagePreFix <span class="token operator">=</span> messagePreFix<span class="token punctuation">;</span><br>    templData<span class="token punctuation">.</span>messagePostFix <span class="token operator">=</span> messagePostFix<span class="token punctuation">;</span><br>    templData<span class="token punctuation">.</span>title <span class="token operator">=</span> messageSubject<span class="token punctuation">;</span><br>    <span class="token comment">//get Options end---------------------------</span><br>     <br>    <span class="token comment">// fop each Sheet defined in body options</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> h<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> h<span class="token operator">&lt;</span>sheetsToEmail<span class="token punctuation">.</span>length<span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>display<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span>      <br>       <br>      <span class="token comment">//template Data ********************************************* title and display</span><br>      <span class="token keyword">var</span> templDataSection <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">"title"</span> <span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string-property property">"display"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string-property property">"headers"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string-property property">"data"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string-property property">"style"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string-property property">'dynamicEmails'</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <br>      templDataSection<span class="token punctuation">.</span>title<span class="token operator">=</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">;</span><br>      templDataSection<span class="token punctuation">.</span>display<span class="token operator">=</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>display<span class="token punctuation">;</span>      <br>             <br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>display <span class="token operator">!=</span> <span class="token string">"title"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>display <span class="token operator">!=</span> <span class="token string">"paragraph"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">//Get sheet </span><br>        <span class="token keyword">var</span> sheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> range <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getDataRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> values <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getDisplayValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> backgrounds <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getBackgrounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> color <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getFontColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> fontWeights <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getFontWeights</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> fontStyles <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getFontStyles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> fontLines <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getFontLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> lastRow <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>         <br>         <br>        <span class="token comment">//template Data ********************************************* Headers</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> g <span class="token operator">&lt;</span> sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">.</span>length<span class="token punctuation">;</span> g<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>          templDataSection<span class="token punctuation">.</span>headers<span class="token punctuation">[</span>g<span class="token punctuation">]</span> <span class="token operator">=</span> values<span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>headersAtRow<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <br>        <span class="token punctuation">}</span>            <br>         <br>         <br>        <span class="token keyword">var</span> countRows<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><br> <br>        <span class="token comment">//Charts</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>templDataSection<span class="token punctuation">.</span>display<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"chart"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>           templDataSection<span class="token punctuation">.</span>data <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>           <br>          <span class="token comment">//for each row in sheet</span><br>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>headersAtRow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lastRow<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>       <br>            <span class="token comment">//template Data ********************************************* Data and style inir</span><br>            templDataSection<span class="token punctuation">.</span>data<span class="token punctuation">[</span>countRows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>            templDataSection<span class="token punctuation">.</span>style<span class="token punctuation">[</span>countRows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>             <br>            <span class="token comment">//for each columnsToSend</span><br>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>              <span class="token comment">//Write values ---- MESSAGE ---</span><br>              <span class="token keyword">var</span> cssStyle<span class="token operator">=</span><span class="token string">"background-color:"</span> <span class="token operator">+</span> backgrounds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <br>              <span class="token operator">+</span> <span class="token string">";color:"</span> <span class="token operator">+</span> color<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <br>              <span class="token operator">+</span> <span class="token string">";font-weight:"</span> <span class="token operator">+</span> fontWeights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <br>              <span class="token operator">+</span> <span class="token string">";font-style:"</span> <span class="token operator">+</span> fontStyles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <br>              <span class="token operator">+</span> <span class="token string">";text-decoration:"</span> <span class="token operator">+</span> fontLines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <br>              <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>             <br>              <span class="token comment">//template Data ********************************************* Data and style </span><br>              <span class="token keyword">var</span> valueData <span class="token operator">=</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>columnsToSend<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>              <span class="token comment">//replace html with links</span><br>              <span class="token keyword">if</span> <span class="token punctuation">(</span>replaceLinks<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token comment">//var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])/ig;</span><br>                <span class="token keyword">var</span> exp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\b(https?|ftp|file):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])(?![^&lt;>]*>(?:(?!&lt;\/?a\b).)*&lt;\/a>)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">;</span><br>                valueData<span class="token operator">=</span>valueData<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>exp<span class="token punctuation">,</span> <span class="token string">"&lt;a href='$1'>$1&lt;/a>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                valueData<span class="token operator">=</span>valueData<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><br>              templDataSection<span class="token punctuation">.</span>data<span class="token punctuation">[</span>countRows<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> valueData<span class="token punctuation">;</span><br>              templDataSection<span class="token punctuation">.</span>style<span class="token punctuation">[</span>countRows<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> cssStyle<span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            <span class="token comment">//to be used in dynamic emails</span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>emailColumn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>              templDataSection<span class="token punctuation">.</span>dynamicEmails<span class="token punctuation">[</span>countRows<span class="token punctuation">]</span> <span class="token operator">=</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sheetsToEmail<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">.</span>emailColumn<span class="token punctuation">]</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            countRows<span class="token operator">++</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>      <span class="token comment">// END IF HERE</span><br>             <br>      <span class="token comment">//template Data ********************************************* </span><br>      templData<span class="token punctuation">.</span>sections<span class="token punctuation">[</span>h<span class="token punctuation">]</span> <span class="token operator">=</span> templDataSection<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span>        <br>     <br>     <br>         <br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" ERROR: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    templData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'logingName + " - prepareTemplateData'</span><span class="token punctuation">,</span> <span class="token literal-property property">initialData</span><span class="token operator">:</span> templData<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - prepareTemplateData ENDED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableStackdriverLogging<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span>logingName <span class="token operator">+</span> <span class="token string">" - prepareTemplateData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> templData<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>I also created different HTML Files to be used as templates for the different display options. See below an example template:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?!= templDataSection.title ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token prolog">&lt;? //for all data rows<br>for (var i = 0; i &lt; templDataSection.data.length; i++)  { ?></span> <br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>    <br>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span><br>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ffffff<span class="token punctuation">;</span><br>    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><br><span class="token prolog">&lt;? //for all data columns<br>  for (var j = 0; j &lt; templDataSection.data[i].length; j++)  { ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token value css language-css">&lt;?!=templDataSection.style[i][j]?><span class="token punctuation">;</span>&lt;? <span class="token selector">if (j==1)</span><span class="token punctuation">{</span>?><span class="token property">font-size</span><span class="token punctuation">:</span>45px<span class="token punctuation">;</span>&lt;?<span class="token punctuation">}</span><span class="token selector">else</span><span class="token punctuation">{</span>?><span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>&lt;?<span class="token punctuation">}</span>?><span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></span><span class="token punctuation">'</span></span></span><span class="token punctuation">></span></span><span class="token prolog">&lt;?!=templDataSection.data[i][j]?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token prolog">&lt;? }  ?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token prolog">&lt;? if ((i+1) %3 == 0)  {?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token prolog">&lt;? }  ?></span><br><span class="token prolog">&lt;? }  ?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>

                    </div>
                </div>
            </div>
        </main>
        <!-- Footer -->
            <footer class="govcy-container-fluid govcy-p-3 govcy-pl-0 govcy-d-print-none">
        <div class="govcy-container">
            <div class="row">   
                <div class="govcy-footer">
                    <ul class="govcy-d-inline-block govcy-m-0  govcy-pl-0 govcy-efs-medium"><li>
                                <a href="/">
                                    Home
                                </a>
                            </li><li>
                                <a href="/blog/">
                                    Blog
                                </a>
                            </li><li>
                                <a href="/about/">
                                    About
                                </a>
                            </li><li>
                                <a href="/search/">
                                    Search
                                </a>
                            </li><li><a href="/feed.xml">Feed</a></li>
                        <li>
                            <a href="/accessibility/">
                                Accessibility
                            </a>
                        </li>
                        <li class="govcy-d-block govcy-text-dark">
                            <a href="/accessibility/#report" class="general-a11y-badge">
                                        
                                        <img src="https://a11ybadges.com/badge?logo=smile&amp;text=a11y_passed&amp;badgeColor=green" alt="Accessibility check passed" class="success-a11y-badge">
                                
                             </a>
                        </li>
                        <li class="govcy-d-block govcy-text-dark">© Constantinos Evangelou, 2025</li>
                        <li class="govcy-d-block govcy-text-dark">Powered by <a href='https://www.11ty.dev/' target='_blank'>Eleventy</a> and <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a>.</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <div class="d-none govcy-p-0 govcy-m-0 d-print-block govcy-text-dark">
        © Constantinos Evangelou, 2025
    </div>
        <!-- js stuff -->
                <!-- Option 1: Bootstrap Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
        
        <script data-goatcounter="https://consevangelou.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>       
    </body>
</html>